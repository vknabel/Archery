name: Archery
version: 0.2.0
apiLevel: 2
repository: https://github.com/vknabel/Archery
loaders:
  - cat Metadata/*.yml
  - swift Scripts/MapSwiftTargetsToScripts.swift --package-path .
scripts:
  greet: echo Hello
  clean:
    arrow: vknabel/BashArrow
    command: rm -rf .archery && swift package clean
    printCommandBeforeExecution: true
  xcopen: swift package generate-xcodeproj --enable-code-coverage && open *.xcodeproj
  format:
    arrow: vknabel/BashArrow
    help: |-
      Reformats all Swift code. Requires swiftformat to be installed globally.
      See https://github.com/nicklockwood/SwiftFormat/pull/183
    comment: Requires https://github.com/nicklockwood/SwiftFormat/pull/183
    command: swiftformat .
  lint:
    arrow: vknabel/MintArrow
    help: Lints all project files
    package: Realm/Swiftlint
  test:
    help: Runs tests on your current host system, but also on supported linux versions
    run: [host, swift5.0, swift5.1]
    scripts:
      host: swift test
      swift5.0:
        env:
          SWIFT_VERSION: 5.0
        command: |-
          export CONTAINER=$(docker create --rm --workdir /archery swift:$SWIFT_VERSION swift test)
          docker cp . $CONTAINER:/archery
          docker start --attach $CONTAINER
      swift5.1:
        env:
          SWIFT_VERSION: 5.1
        command: |-
          export CONTAINER=$(docker create --rm --workdir /archery swift:$SWIFT_VERSION swift test)
          docker cp . $CONTAINER:/archery
          docker start --attach $CONTAINER
  generate:
    arrow: vknabel/ArcheryArrow
    run:
      - readme
      - version
      - init-command
      - linux-main
      - format
      - docs
    scripts:
      readme:
        arrow: vknabel/StencilArrow
        template: README.md.stencil
        destination: README.md
        searchPaths:
          - Scripts
      version:
        arrow: vknabel/StencilArrow
        template: Version.swift.stencil
        destination: Sources/ArcheryKit/Version.generated.swift
        searchPaths:
          - Scripts
      init-command:
        arrow: vknabel/StencilArrow
        template: InitCommand+Contents.swift.stencil
        destination: Sources/ArcheryInterface/InitCommand+Contents.swift
        searchPaths:
          - Scripts
      docs: |
        if which jazzy >/dev/null; then
          jazzy
        else
          echo Skip: Jazzy not available
        fi
      linux-main: swift test --generate-linuxmain
